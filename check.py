# -*- coding: utf-8 -*-
import time
import requests
import os
import locale
import pytz

try:
      locale.setlocale(locale.LC_TIME, 'ru_RU')
except:
      locale.setlocale(locale.LC_ALL, '')

def check(place):
    url = 'https://meteoinfo.ru/hmc-output/meteoalert/map_fed_data.php'

    html = requests.get(url).text                                            
    data = eval(html)                                                       

    places = {
              '–æ—Ä–µ–ª': '51',
              '–æ—Ä—ë–ª': '51',
              '–≤–æ—Ä–æ–Ω–µ–∂': '77',
              '–∫—É—Ä—Å–∫': '33', 
              '–∫–∞–ª—É–≥–∞': '27', 
              '–±—Ä—è–Ω—Å–∫': '7', 
              '—è—Ä–æ—Å–ª–∞–≤–ª—å': '81',
              '—Å–º–æ–ª–µ–Ω—Å–∫': '60',
              '—Ç–∞–º–±–æ–≤': '65',
              '–∫–æ—Å—Ç—Ä–æ–º–∞': '36',
              '—Ç–≤–µ—Ä—å': '70',
              '–≤–ª–∞–¥–∏–º–∏—Ä': '75',
              '—Ç—É–ª–∞': '68',
              '–º–æ': '43',
              '–º–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '43',
              '–±–µ–ª–≥–æ—Ä–æ–¥': '6',
              '—Ä—è–∑–∞–Ω—å': '57',
              '–ª–∏–ø–µ—Ü–∫': '38',
              '–∏–≤–∞–Ω–æ–≤–æ': '19',
              '–º–æ—Å–∫–≤–∞': '102'
      }

    area = data[places[place]]

    intsn = {
          '0': '–ó–µ–ª–µ–Ω—ã–π',
          '1': '–ó–µ–ª–µ–Ω—ã–π',
          '2': '–ñ–µ–ª—Ç—ã–π',
          '3': '–û—Ä–∞–Ω–∂–µ–≤—ã–π',
          '4': '–ö—Ä–∞—Å–Ω—ã–π'      
    }
    
    areas = {
          '–±–µ–ª–≥–æ—Ä–æ–¥': '–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–±—Ä—è–Ω—Å–∫': '–ë—Ä—è–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–≤–ª–∞–¥–∏–º–∏—Ä': '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–≤–æ—Ä–æ–Ω–µ–∂': '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–∏–≤–∞–Ω–æ–≤–æ': '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–∫–∞–ª—É–≥–∞': '–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–∫–æ—Å—Ç—Ä–æ–º–∞': '–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–∫—É—Ä—Å–∫': '–ö—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–ª–∏–ø–µ—Ü–∫': '–õ–∏–ø–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–º–æ': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–º–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–æ—Ä–µ–ª': '–û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–æ—Ä—ë–ª': '–û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '—Ä—è–∑–∞–Ω—å': '–†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '—Å–º–æ–ª–µ–Ω—Å–∫': '–°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '—Ç–∞–º–±–æ–≤': '–¢–∞–º–±–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '—Ç–≤–µ—Ä—å': '–¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '—Ç—É–ª–∞': '–¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '—è—Ä–æ—Å–ª–∞–≤–ª—å': '–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
          '–º–æ—Å–∫–≤–∞': '–ú–æ—Å–∫–≤–∞'

    }
    alert = {
          '–ì—Ä–æ–∑–∞': '‚õàÔ∏è',
          '–î–æ–∂–¥—å': '‚òî',
          '–í–µ—Ç–µ—Ä': 'üí®',
          '–ó–∞–º–æ—Ä–æ–∑–∫–∏': '‚ûñ',
          '–¢—É–º–∞–Ω': 'üå´Ô∏è',
          '–û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞': 'üå°Ô∏èüîª',
          '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞': 'üå°Ô∏èüî∫',
          '–í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞': 'üå°Ô∏èüî∫',
          '—Å–∏–ª—å–Ω–∞—è –∂–∞—Ä–∞': 'üå°Ô∏èüî∫',
          '–í—ã—Å–æ–∫–∞—è –ø–æ–∂–∞—Ä–æ–æ–ø–∞—Å–Ω–æ—Å—Ç—å': 'üî•',
          '–ü–æ–∂–∞—Ä–Ω–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å': 'üî•',
          '–ü–∞–≤–æ–¥–æ–∫': 'üíß',
          '–ü—ã–ª—å–Ω–∞—è (–ø–µ—Å—á–∞–Ω–∞—è) –±—É—Ä—è': 'üå™Ô∏è',
          '–ü—Ä–æ—á–∏–µ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏': '‚ùó',
          '–°–Ω–µ–≥/–û–±–ª–µ–¥–µ–Ω–µ–Ω–∏–µ': '‚ùÑÔ∏è',
          '–ü—Ä–∏–±—Ä–µ–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è': 'üèñÔ∏è',
          '–õ–∞–≤–∏–Ω—ã': '‚õ∞Ô∏è',
          '–°–µ–ª—å': '‚õ∞Ô∏è',
          '–ù–∞–≤–æ–¥–Ω–µ–Ω–∏–µ': 'üåä',
          '–ì–æ–ª–æ–ª–µ–¥–Ω–æ - –∏–∑–º–æ—Ä–æ–∑–µ–≤–æ–µ –æ—Ç–ª–æ–∂–µ–Ω–∏–µ': '‚õ∏Ô∏è',
          '–û–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –ø–æ–≥–æ–¥–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è': ''
    }
    length = (len(area))
    text = []
    for k in range(0, length):
          weather = area[str(k)]["3"]
          intensity = str(area[str(k)]['2'])[0]
          start_time = time.strftime('%H:%M %d %B', time.localtime(int(area[str(k)]['0'])))
          end_time = time.strftime('%H:%M %d %B', time.localtime(int(area[str(k)]['1'])))
          if int(time.strftime('%H', time.localtime(int(area[str(k)]['0'])))) == int(time.strftime('%H', time.localtime())):
                start_from = ''
          else:
                start_from = ' c ' + str(start_time)
          r = area[str(k)]['4']
          if r == '':
                remark = '–£—Ç–æ—á–Ω–µ–Ω–∏–π –Ω–µ—Ç'
          else:
                remark = r
          text.append('üó∫Ô∏è –†–µ–≥–∏–æ–Ω: ' + areas[str(place)] + '\n' + '‚ö†Ô∏è –û–ø–æ–≤–µ—â–µ–Ω–∏–µ: ' + weather + alert[weather] + '\n' + 'üïë –ü–µ—Ä–∏–æ–¥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è ‚Äî ' + start_from + ' –¥–æ ' + end_time + '\n' + 'üìù –£—Ç–æ—á–Ω–µ–Ω–∏—è: ' + remark + '\n' + '‚ùóÔ∏è –£—Ä–æ–≤–µ–Ω—å: ' + intsn[intensity] + '\n')
    return '\n\n'.join(text)

